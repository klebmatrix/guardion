<!DOCTYPE html>
<html>
<head>
    <title>Painel de Conversão WBTC</title>
    <style>
        body { background: #0a0e17; color: white; font-family: sans-serif; text-align: center; }
        .grid { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; padding: 20px; }
        .card { background: #161e2d; border: 2px solid #3b82f6; padding: 20px; border-radius: 15px; width: 280px; }
        .btn-converter { 
            background: #f7931a; color: white; border: none; padding: 12px; 
            width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 15px;
        }
        .btn-converter:hover { background: #e88310; }
        .status-msg { font-size: 12px; color: #10b981; margin-top: 10px; height: 20px; }
    </style>
</head>
<body>
    <h1>CONVERSOR AGENTE MULTI (WBTC)</h1>
    <p>Selecione o módulo para transformar saldo em WBTC</p>

    <div class="grid">
        {% for nome, carteira in modulos.items() %}
        <div class="card">
            <h2 style="color: #f7931a;">{{ nome }}</h2>
            <img src="/qr/{{ carteira }}" width="180" style="background: white; padding: 5px; border-radius: 8px;">
            <p><small>Destino WBTC: {{ carteira[:10] }}...</small></p>
            
            <button class="btn-converter" onclick="solicitarConversao('{{ nome }}')">
                CONVERTER AGORA ➔ WBTC
            </button>
            <div id="status-{{ nome }}" class="status-msg"></div>
        </div>
        {% endfor %}
    </div>

    <script>
        async function solicitarConversao(idModulo) {
            const statusDiv = document.getElementById('status-' + idModulo);
            statusDiv.innerText = "Processando com Agente...";
            
            try {
                const response = await fetch('/converter', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({modulo: idModulo})
                });
                const result = await response.json();
                statusDiv.innerText = result.msg;
            } catch (err) {
                statusDiv.innerText = "Erro na conexão com o Agente.";
            }
        }
    </script>
</body>
</html>