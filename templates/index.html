<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GUARDION OMNI | AGENTE AUT√îNOMO</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050505; --card: #0d0d0d; --accent: #00f2ff; --text: #e0e0e0; --wbtc: #f7931a; --usdt: #26a17b; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #1a1a1a; padding-bottom: 15px; margin-bottom: 25px; }
        .logo { font-size: 22px; font-weight: 900; letter-spacing: 2px; color: var(--accent); text-shadow: 0 0 10px rgba(0,242,255,0.3); }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--card); border: 1px solid #222; border-radius: 12px; padding: 20px; transition: 0.3s; }
        .card:hover { border-color: var(--accent); box-shadow: 0 0 15px rgba(0,242,255,0.1); }
        .card h2 { margin: 0 0 15px 0; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; }

        .saldos-box { font-family: 'JetBrains Mono', monospace; font-size: 14px; background: #000; padding: 15px; border-radius: 8px; border: 1px solid #1a1a1a; }
        .saldo-item { display: flex; justify-content: space-between; padding: 4px 0; }
        .val { font-weight: bold; color: var(--accent); }

        .btn { width: 100%; padding: 12px; border-radius: 6px; border: none; font-weight: 800; cursor: pointer; transition: 0.2s; margin-top: 15px; text-transform: uppercase; }
        .btn-wbtc { background: var(--wbtc); color: #000; }
        .btn-usdt { background: var(--usdt); color: #000; }
        .btn-multi { background: #8b5cf6; color: white; }
        .btn:active { transform: scale(0.98); }

        .hist-section { background: var(--card); border: 1px solid #222; border-radius: 12px; padding: 20px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-family: 'JetBrains Mono', monospace; font-size: 12px; }
        th { text-align: left; color: #555; border-bottom: 1px solid #222; padding: 10px; }
        td { padding: 12px 10px; border-bottom: 1px solid #151515; }
        .hash { color: #555; font-size: 10px; }
        
        #status-bar { position: fixed; bottom: 20px; right: 20px; background: var(--accent); color: #000; padding: 10px 20px; border-radius: 50px; font-weight: bold; display: none; z-index: 100; }
    </style>
</head>
<body>

<header>
    <div class="logo">üõ°Ô∏è GUARDION_OMNI_v2</div>
    <a href="/logout" style="color: #ff4d4d; text-decoration: none; font-weight: bold; font-size: 12px;">DISCONNECT_AGENT</a>
</header>

<div id="status-bar">PROCESSANDO...</div>

<div class="grid">
    <div class="card">
        <h2>M√≥dulo 01: Opera√ß√£o WBTC</h2>
        <div class="saldos-box">
            <div class="saldo-item"><span>POL:</span> <span class="val" id="pol-MOD_01">0.0000</span></div>
            <div class="saldo-item"><span>USDC:</span> <span class="val" id="usdc-MOD_01">0.00</span></div>
            <div class="saldo-item"><span>WBTC:</span> <span class="val" id="wbtc-MOD_01">0.0000</span></div>
        </div>
        <button class="btn btn-wbtc" onclick="executar('MOD_01')">Executar Swap: WBTC</button>
    </div>

    <div class="card">
        <h2>M√≥dulo 02: Opera√ß√£o USDT</h2>
        <div class="saldos-box">
            <div class="saldo-item"><span>POL:</span> <span class="val" id="pol-MOD_02">0.0000</span></div>
            <div class="saldo-item"><span>USDC:</span> <span class="val" id="usdc-MOD_02">0.00</span></div>
            <div class="saldo-item"><span>USDT:</span> <span class="val" id="usdt-MOD_02">0.00</span></div>
        </div>
        <button class="btn btn-usdt" onclick="executar('MOD_02')">Executar Swap: USDT</button>
    </div>

    <div class="card">
        <h2>M√≥dulo 03: Multi-Crypto</h2>
        <div class="saldos-box">
            <div class="saldo-item"><span>POL:</span> <span class="val" id="pol-MOD_03">0.0000</span></div>
            <div class="saldo-item"><span>USDC:</span> <span class="val" id="usdc-MOD_03">0.00</span></div>
            <div class="saldo-item"><span>ATIVOS:</span> <span class="val">DIVERSIFICADO</span></div>
        </div>
        <button class="btn btn-multi" onclick="executar('MOD_03')">Diversificar Cesta</button>
    </div>
</div>

<div class="hist-section">
    <h2 style="font-size: 14px; margin-bottom: 15px; color: var(--accent);">üì° LOG DE MOVIMENTA√á√ïES (BLOCKCHAIN)</h2>
    <table>
        <thead>
            <tr>
                <th>TIMESTAMP</th>
                <th>M√ìDULO</th>
                <th>ESTRAT√âGIA</th>
                <th>TX_HASH</th>
            </tr>
        </thead>
        <tbody id="hist-corpo">
            </tbody>
    </table>
</div>



<script>
    async function refreshData() {
        try {
            const resSaldos = await fetch('/saldos');
            const saldos = await resSaldos.json();
            for (let mod in saldos) {
                if(document.getElementById(`pol-${mod}`)) {
                    document.getElementById(`pol-${mod}`).innerText = saldos[mod].pol;
                    document.getElementById(`usdc-${mod}`).innerText = saldos[mod].usdc;
                    if(saldos[mod].wbtc) document.getElementById(`wbtc-${mod}`).innerText = saldos[mod].wbtc;
                    if(saldos[mod].usdt) document.getElementById(`usdt-${mod}`).innerText = saldos[mod].usdt;
                }
            }

            const resHist = await fetch('/historico');
            const hist = await resHist.json();
            const histCorpo = document.getElementById('hist-corpo');
            histCorpo.innerHTML = hist.map(row => `
                <tr>
                    <td>${row[1]}</td>
                    <td><span style="background:#111; padding:2px 6px; border-radius:4px; color:var(--accent)">${row[2]}</span></td>
                    <td>${row[3]}</td>
                    <td class="hash">${row[4]}</td>
                </tr>
            `).join('');
        } catch (e) { console.error("Erro ao sincronizar Agente."); }
    }

    async function executar(modulo) {
        const bar = document.getElementById('status-bar');
        bar.style.display = 'block';
        try {
            const res = await fetch('/converter', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({modulo: modulo})
            });
            const data = await res.json();
            bar.innerText = "ORDEM ENVIADA!";
            setTimeout(() => bar.style.display = 'none', 3000);
            refreshData();
        } catch (e) { bar.innerText = "ERRO NA REDE"; }
    }

    setInterval(refreshData, 8000);
    refreshData();
</script>
</body>
</html>